<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Error Fixes Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .error-test {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007cba;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        nav.toc {
            background: #f8f9fa;
            padding: 20px;
            border: 1px solid #dee2e6;
            margin: 20px 0;
        }
        nav.toc ul {
            list-style: none;
            padding-left: 20px;
        }
        nav.toc li {
            margin: 5px 0;
        }
        nav.toc a {
            text-decoration: none;
            color: #007cba;
        }
        nav.toc a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>JavaScript Error Fixes Test</h1>
    
    <div class="error-test">
        <h3>Testing Error Handling</h3>
        <p>This page tests the JavaScript error fixes implemented in code.js</p>
    </div>

    <!-- Test TOC structure -->
    <nav class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li><a href="#section1">Section 1</a>
                <ul>
                    <li><a href="#subsection1">Subsection 1</a></li>
                    <li><a href="#subsection2">Subsection 2</a></li>
                </ul>
            </li>
            <li><a href="#section2">Section 2</a></li>
            <li><a href="#section3">Section 3</a>
                <ul>
                    <li><a href="#subsection3">Subsection 3</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <main>
        <section id="section1">
            <h2>Section 1</h2>
            <p>This is section 1 content.</p>
            
            <div id="subsection1">
                <h3>Subsection 1</h3>
                <p>This is subsection 1 content.</p>
            </div>
            
            <div id="subsection2">
                <h3>Subsection 2</h3>
                <p>This is subsection 2 content.</p>
            </div>
        </section>

        <section id="section2">
            <h2>Section 2</h2>
            <p>This is section 2 content.</p>
        </section>

        <section id="section3">
            <h2>Section 3</h2>
            <p>This is section 3 content.</p>
            
            <div id="subsection3">
                <h3>Subsection 3</h3>
                <p>This is subsection 3 content.</p>
            </div>
        </section>
    </main>

    <!-- Test broken image -->
    <img src="images-slides/nonexistent.jpg" alt="Test broken image" style="display: none;">

    <!-- Include jQuery for testing -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    
    <!-- Include our fixed code.js -->
    <script src="code.js"></script>

    <!-- Test script to verify fixes -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== Testing JavaScript Error Fixes ===');
            
            // Test 1: Check if StickyTOC is available
            if (window.StickyTOC) {
                console.log('✓ StickyTOC module loaded successfully');
                
                // Run diagnostics
                const issues = window.StickyTOC.debug.diagnostics();
                console.log('Diagnostics completed:', issues);
            } else {
                console.error('✗ StickyTOC module failed to load');
            }

            // Test 2: Test jQuery load function with invalid parameter
            if (window.jQuery) {
                console.log('✓ jQuery is available');
                
                // This should not cause an error now
                try {
                    jQuery('<div>').load(null);
                    console.log('✓ jQuery load function handled null parameter gracefully');
                } catch (error) {
                    console.error('✗ jQuery load function still has issues:', error);
                }
            }

            // Test 3: Test IntersectionObserver with invalid target
            if (window.IntersectionObserver) {
                console.log('✓ IntersectionObserver is available');
                
                try {
                    const observer = new IntersectionObserver(() => {});
                    observer.observe(null); // This should not cause an error now
                    console.log('✓ IntersectionObserver handled null target gracefully');
                } catch (error) {
                    console.error('✗ IntersectionObserver still has issues:', error);
                }
            }

            // Test 4: Test TOC functionality
            setTimeout(() => {
                if (window.StickyTOC) {
                    try {
                        window.StickyTOC.toggle();
                        console.log('✓ TOC toggle function works');
                        
                        window.StickyTOC.nested.expandAll();
                        console.log('✓ Nested expand all function works');
                        
                        window.StickyTOC.nested.collapseAll();
                        console.log('✓ Nested collapse all function works');
                    } catch (error) {
                        console.error('✗ TOC functions have issues:', error);
                    }
                }
            }, 1000);

            console.log('=== Test completed ===');
        });
    </script>
</body>
</html>
